# Memory Mesh Environment Configuration
# Copy this file to .env and update with your actual values

# =============================================================================
# Application Settings
# =============================================================================
MEMORY_ENVIRONMENT=local
MEMORY_LOG_LEVEL=INFO
MEMORY_APP_NAME=memorymesh

# =============================================================================
# Database Configuration
# =============================================================================
# PostgreSQL with pgvector (production)
# Example: postgresql+asyncpg://username:password@hostname:5432/database_name
# For cloud providers:
#   - Render: Use the Internal Database URL from your PostgreSQL service
#   - Neon: Use the connection string from your Neon dashboard
#   - Supabase: Use the connection pooler URL for better performance
# MEMORY_DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/memory_layer

# SQLite (local development - default)
# Note: SQLite doesn't support pgvector, so vector search will use fallback implementation
MEMORY_DATABASE_URL=sqlite+aiosqlite:///./memory_layer.db

# Read replica URLs (comma-separated, optional)
# MEMORY_READ_REPLICA_URLS=postgresql+asyncpg://user:password@replica1:5432/memory_layer,postgresql+asyncpg://user:password@replica2:5432/memory_layer

# Database connection pool settings
MEMORY_DATABASE_POOL_SIZE=20
MEMORY_DATABASE_MAX_OVERFLOW=10
MEMORY_DATABASE_POOL_RECYCLE=3600
MEMORY_SQL_ECHO=false

# =============================================================================
# Authentication & Security
# =============================================================================
# JWT Configuration
# ⚠️  CRITICAL: You MUST change MEMORY_JWT_SECRET_KEY before deploying to production!
# Generate a secure key with: python -c 'import secrets; print(secrets.token_urlsafe(32))'
# ⚠️  SECURITY WARNING: This default value is INSECURE and will be REJECTED in production!
MEMORY_JWT_SECRET_KEY=change-me-in-production
MEMORY_JWT_ALGORITHM=HS256
MEMORY_ACCESS_TOKEN_EXPIRE_MINUTES=30
MEMORY_REFRESH_TOKEN_EXPIRE_DAYS=7

# OAuth Configuration (optional)
# GOOGLE_CLIENT_ID=your-google-client-id
# GOOGLE_CLIENT_SECRET=your-google-client-secret
# GITHUB_CLIENT_ID=your-github-client-id
# GITHUB_CLIENT_SECRET=your-github-client-secret
# OAUTH_REDIRECT_URL=http://localhost:3000/auth/callback

# API Keys (comma-separated, optional)
# MEMORY_API_KEYS=key1,key2,key3

# =============================================================================
# Embedding Configuration
# =============================================================================
# Provider options: mock, sentence_transformer, google_gemini
MEMORY_EMBEDDING_PROVIDER=mock
MEMORY_EMBEDDING_DIMENSIONS=1536
MEMORY_EMBEDDING_MODEL_NAME=sentence-transformers/all-MiniLM-L6-v2

# Google Gemini API Key (required if using google_gemini provider)
# MEMORY_GEMINI_API_KEY=your-gemini-api-key

# Async embedding generation (recommended for production)
MEMORY_ASYNC_EMBEDDINGS=false
MEMORY_EMBEDDING_JOB_POLL_SECONDS=1.0
MEMORY_EMBEDDING_JOB_BATCH_SIZE=10
MEMORY_EMBEDDING_JOB_MAX_ATTEMPTS=3
MEMORY_EMBEDDING_JOB_RETRY_BACKOFF_SECONDS=5.0

# Search settings
MEMORY_MAX_RESULTS=8

# Importance scoring weights (format: recency:0.4,role:0.2,explicit:0.4)
MEMORY_IMPORTANCE_WEIGHTS=recency:0.4,role:0.2,explicit:0.4

# =============================================================================
# Redis Configuration
# =============================================================================
# Redis URL (required for rate limiting and caching in production)
# Format: redis://[username:password@]hostname:port/database
# For cloud providers:
#   - Upstash: Use the Redis URL from your Upstash console
#   - Redis Cloud: Use the public endpoint URL
#   - Render: Use the Internal Redis URL from your Redis service
# MEMORY_REDIS_URL=redis://localhost:6379/0

# Require Redis in production (set to false for local development)
MEMORY_REQUIRE_REDIS_IN_PRODUCTION=true

# =============================================================================
# Rate Limiting
# =============================================================================
# Format: "number/period" where period is: second, minute, hour, day
MEMORY_GLOBAL_RATE_LIMIT=200/minute
MEMORY_TENANT_RATE_LIMIT=120/minute

# =============================================================================
# Caching
# =============================================================================
MEMORY_CACHE_ENABLED=true
MEMORY_CACHE_MAX_ITEMS=2000
MEMORY_CACHE_SEARCH_TTL_SECONDS=60
MEMORY_CACHE_EMBEDDING_TTL_SECONDS=3600

# =============================================================================
# CORS Configuration
# =============================================================================
# Comma-separated list of allowed origins (no wildcards in production)
# For local development, you can use "*" but this is insecure
MEMORY_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8000

# =============================================================================
# Retention Policies
# =============================================================================
MEMORY_RETENTION_MAX_AGE_DAYS=30
MEMORY_RETENTION_IMPORTANCE_THRESHOLD=0.35
MEMORY_RETENTION_DELETE_AFTER_DAYS=90
MEMORY_RETENTION_SCHEDULE_SECONDS=86400
# Comma-separated list of tenant IDs, or "*" for all tenants
MEMORY_RETENTION_TENANTS=*

# =============================================================================
# Request & Timeout Settings
# =============================================================================
MEMORY_REQUEST_TIMEOUT_SECONDS=15
MEMORY_REQUEST_MAX_BYTES=1048576

# =============================================================================
# Circuit Breaker
# =============================================================================
MEMORY_CIRCUIT_FAILURE_THRESHOLD=5
MEMORY_CIRCUIT_RECOVERY_SECONDS=30

# =============================================================================
# Monitoring & Health Checks
# =============================================================================
MEMORY_ENABLE_METRICS=true
MEMORY_HEALTHCHECK_TIMEOUT_SECONDS=2.0
MEMORY_HEALTH_EMBED_CHECK_ENABLED=false
MEMORY_READINESS_EMBED_TIMEOUT_SECONDS=3.0
